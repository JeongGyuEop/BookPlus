<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.order">
    <!-- OrderVO 변경사항 반영:
         goods_id → goods_isbn
         goods_sales_price → goods_priceSales
         goods_fileName → goods_cover
         DB 컬럼명도 동일하게 변경했다고 가정 (goods_id 컬럼 → goods_isbn, goods_fileName → goods_cover 등)
    -->
    <resultMap id="orderGoodsResult" type="OrderVO">
        <result property="order_seq_num" column="order_seq_num"/>
        <result property="order_id" column="order_id"/>
        <result property="member_id" column="member_id"/>
        
        <!-- goods_id → goods_isbn -->
        <result property="goods_isbn" column="goods_isbn"/>
        
        <result property="goods_title" column="goods_title"/>
        
        <!-- goods_sales_price → goods_priceSales -->
        <result property="goods_priceSales" column="goods_priceSales"/>
        
        <result property="total_goods_price" column="order_total_price"/>
        <result property="order_goods_qty" column="order_goods_qty"/>
        <result property="orderer_name" column="orderer_name"/>
        <result property="receiver_name" column="receiver_name"/>
        <result property="receiver_hp1" column="receiver_hp1"/>
        <result property="receiver_hp2" column="receiver_hp2"/>
        <result property="receiver_hp3" column="receiver_hp3"/>
        <result property="receiver_tel1" column="receiver_tel1"/>
        <result property="receiver_tel2" column="receiver_tel2"/>
        <result property="receiver_tel3" column="receiver_tel3"/>
        <result property="delivery_address" column="delivery_address"/>
        <result property="delivery_message" column="delivery_message"/>
        <result property="delivery_method" column="delivery_method"/>
        <result property="gift_wrapping" column="gift_wrapping"/>
        <result property="pay_method" column="pay_method"/>
        <result property="card_com_name" column="card_com_name"/>
        <result property="card_pay_month" column="card_pay_month"/>
        <result property="pay_orderer_hp_num" column="pay_orderer_hp_num"/>
        <result property="pay_order_time" column="pay_order_time"/>
        <result property="delivery_state" column="delivery_state"/>
        <result property="final_total_price" column="final_total_price"/>
        <result property="goods_qty" column="goods_qty"/>
        <result property="orderer_hp" column="orderer_hp"/>
        
        <!-- goods_fileName → goods_cover -->
        <result property="goods_cover" column="goods_cover"/>
    </resultMap>
	
    <!-- 로그인한 회원의 오늘 주문 목록 조회: goods_id → goods_isbn, goods_fileName → goods_cover 반영 -->
	<select id="selectMyOrderList" resultMap="orderGoodsResult" parameterType="orderVO">
	    <![CDATA[
			SELECT *
			FROM T_SHOPPGING_ORDER
			WHERE DATE(pay_order_time) = CURDATE()
        	AND member_id = #{member_id}
        	ORDER BY order_seq_num DESC
		]]>
	</select>

	<!-- 주문 정보 삽입: goods_id → goods_isbn, goods_fileName → goods_cover 반영 -->
	<insert id="insertNewOrder" parameterType="orderVO">
	    <![CDATA[
			INSERT INTO T_SHOPPGING_ORDER(
				order_seq_num,
				order_id,
				member_id,
				goods_isbn,
				goods_title,
				goods_cover,
				order_goods_qty,
				goods_priceSales,
				orderer_name,
				receiver_name,
				receiver_hp1,
				receiver_hp2,
				receiver_hp3,
				receiver_tel1,
				receiver_tel2,
				receiver_tel3,
				delivery_address,
				delivery_message,
				delivery_method,
				gift_wrapping,
				pay_method,
				card_com_name,
				card_pay_month,
				orderer_hp,
				pay_orderer_hp_num
			) VALUES (
				NULL,
				#{order_id},
				#{member_id},
				#{goods_isbn},
				#{goods_title},
				#{goods_cover},
				#{order_goods_qty},
				#{goods_priceSales},
				#{orderer_name},
				#{receiver_name},
				#{receiver_hp1},
				#{receiver_hp2},
				#{receiver_hp3},
				#{receiver_tel1},
				#{receiver_tel2},
				#{receiver_tel3},
				#{delivery_address},
				#{delivery_message},
				#{delivery_method},
				#{gift_wrapping},
				#{pay_method},
				#{card_com_name},
				#{card_pay_month},
				#{orderer_hp},
				#{pay_orderer_hp_num}
			)
		]]>
	</insert>

	<!-- selectOrderID는 MySQL auto_increment 사용 시 필요 없음 -->
	<select id="selectOrderID" resultType="int">
	    <![CDATA[
			SELECT NULL
		]]>
	</select>

	<!-- 특정 order_id로 오늘 주문 조회: goods_id → goods_isbn, goods_fileName → goods_cover 반영 -->
	<select id="selectMyOrder" resultMap="orderGoodsResult" parameterType="String">
	    <![CDATA[
			SELECT *
			FROM T_SHOPPGING_ORDER
            WHERE DATE(pay_order_time) = CURDATE()
            AND order_id = #{order_id}
            ORDER BY pay_order_time DESC
    	]]>
	</select>

	<!-- 장바구니에서 상품 삭제: goods_id → goods_isbn로 변경 -->
	<delete id="deleteGoodsFromCart" parameterType="orderVO">
	    <![CDATA[
			DELETE FROM T_SHOPPING_CART
			WHERE goods_isbn = #{goods_isbn}
		]]>
	</delete>
</mapper>
